install.packages("caret")
install.packages("Boruta")
install.packages("dplyr")

library(caret)
library(Boruta)
library(dplyr)

DATA.DIR <- "../Final project stuff"

# retrive sample data for analysis
train <- read.csv(paste0(DATA.DIR,"/train.csv"),stringsAsFactors = FALSE)
###
# select random sample for analysis using caret createDataPartition() function
###
set.seed(123)
idx <- createDataPartition(train$target,p=0.01,list=FALSE)
sample.df <- train[idx,]

###
# segregate numeric vs character data types
###
# get names of the explanatory variables
explanatory.attributes <- setdiff(names(sample.df),c("ID","target"))

# determine data type for each explanatory variable
data.classes <- sapply(explanatory.attributes,function(x){class(sample.df[,x])})

# segregate explanatory variables by data type, eg. character, numeric, integer
unique.classes <- unique(data.classes)
attr.by.data.types <- lapply(unique.classes,function(x){names(data.classes[data.classes==x])})
names(attr.by.data.types) <- unique.classes
comment(attr.by.data.types) <- "list that categorize training data types"


# for numeric attributes use caret preProcess() and predict() functions to impute missing values
pp <- preProcess(sample.df[c(attr.by.data.types$numeric,attr.by.data.types$integer)],
                 method=c("medianImpute"))
pp.sample.df <- predict(pp,sample.df[c(attr.by.data.types$numeric,attr.by.data.types$integer)])

# combine numeric data with character data
df <- cbind(pp.sample.df,sample.df[attr.by.data.types$character])

##Analyze sample data with Boruta package to determine relevance of the explanatory variables.
set.seed(13)
bor.results <- Boruta(df,factor(sample.df$target),
                      maxRuns=101,
                      doTrace=0)
## 
## summary of Boruta run:
## Boruta performed 100 iterations in 6.393883 mins.
##  20 attributes confirmed important: v10, v101, v106, v110, v12 and
## 15 more.
##  92 attributes confirmed unimportant: v1, v100, v102, v104, v105
## and 87 more.
##  19 tentative attributes left: v103, v108, v109, v111, v121 and 14
## more.
##
##
## Attributes determined to be relevant:
##  [1] "v10"  "v12"  "v14"  "v17"  "v32"  "v48"  "v50"  "v51"  "v64"  "v73" 
## [11] "v76"  "v93"  "v101" "v106" "v62"  "v129" "v31"  "v47"  "v66"  "v110"
##
##
##
##
## 
## 
## Attribute importance details:
##     attr     meanImp   medianImp      minImp      maxImp normHits  decision
## 1    v50 16.09037082 16.30075874 11.40571330 19.01823140     1.00 Confirmed
## 2    v10  7.73220513  7.78592602  5.50528860  9.91485500     1.00 Confirmed
## 3    v14  7.10837286  7.27653084  3.57023366  9.59161138     1.00 Confirmed
## 4   v129  6.59530576  6.58982514  4.71428570  9.32572195     1.00 Confirmed
## 5    v48  6.12107967  6.30675997  2.63030074  7.96703701     0.96 Confirmed
## 6    v12  6.13176270  6.30304108  2.36537703  8.64728401     0.94 Confirmed
## 7    v31  5.95773769  6.08318017  3.64166130  7.45033688     0.99 Confirmed
## 8   v106  5.63148910  5.80430013  2.63734791  7.79213280     0.98 Confirmed
## 9    v64  5.37843476  5.51098802  2.66239317  7.32263184     0.93 Confirmed
## 10   v17  5.24121549  5.38410322  1.93335717  7.72947856     0.90 Confirmed
## 11   v76  4.99207308  5.29802970  0.67103797  7.01246370     0.90 Confirmed
## 12  v101  4.54150618  4.76403618  1.03894614  6.52243273     0.84 Confirmed
## 13   v66  4.65291649  4.72883226  1.93563109  7.58339773     0.86 Confirmed
## 14   v32  4.52399184  4.54474386  1.81553861  7.09979022     0.86 Confirmed
## 15   v93  4.23360920  4.45358652  1.24628984  6.81879908     0.80 Confirmed
## 16   v47  4.33746639  4.45230206  1.16805986  6.29364041     0.88 Confirmed
## 17   v73  4.31711533  4.33777743  1.76217530  6.56440832     0.82 Confirmed
## 18   v62  4.25266682  4.29537892  2.38071701  6.26565549     0.86 Confirmed
## 19   v51  3.99468002  4.08198575  0.68057790  6.29107959     0.78 Confirmed
## 20  v110  3.89270003  3.81654373  1.91205686  5.96129793     0.76 Confirmed
## 21   v21  3.63991073  3.62125524  1.23878323  6.09474861     0.65 Tentative
## 22   v36  3.58125601  3.61154773  0.26836695  6.31460483     0.65 Tentative
## 23   v44  3.56054547  3.57047567  1.36067984  6.41965354     0.66 Tentative
## 24   v20  3.40286171  3.56253014 -0.53432596  5.83138816     0.60 Tentative
## 25  v111  3.43030320  3.40778570  0.80251378  6.14606459     0.65 Tentative
## 26   v84  3.19564867  3.40103581  0.11775742  5.35462419     0.57 Tentative
## 27  v108  3.37772453  3.39020228 -0.46139860  5.72315179     0.60 Tentative
## 28   v79  3.26271329  3.34890572  1.48619136  5.00331984     0.53 Tentative
## 29  v128  3.31489222  3.33362479  0.46899550  5.42136647     0.61 Tentative
## 30   v86  3.19625915  3.30553482  0.33472091  6.07575213     0.55 Tentative
## 31   v15  3.15136227  3.22361997 -0.08932266  5.81659540     0.54 Tentative
## 32  v103  3.05877836  3.17248120  0.80054015  5.66995504     0.53 Tentative
## 33    v2  3.05612964  3.14896056 -0.13564787  5.37823837     0.50 Tentative
## 34  v109  2.92419655  3.07469239 -0.48031277  5.72801085     0.47 Tentative
## 35   v33  2.99171870  2.96958664 -0.84053084  5.26485512     0.50 Tentative
## 36    v5  2.81716631  2.88158790  0.04136167  5.29537412     0.47 Tentative
## 37  v121  2.90320244  2.88025517  0.53380858  5.62797090     0.45 Tentative
## 38   v87  2.78416322  2.86270507 -0.09533152  5.27017946     0.43 Tentative
## 39   v59  2.67539000  2.63679911 -1.11684982  5.39481251     0.43 Tentative
## 40   v97  2.47334740  2.43934412 -0.03384168  5.02248452     0.30  Rejected
## 41  v114  2.17839761  2.27084802 -0.89927133  4.52463764     0.24  Rejected
## 42   v34  1.92387986  2.21029317 -1.13737027  3.44877957     0.10  Rejected
## 43   v70  2.14419410  2.17266396 -0.11025753  3.92870670     0.10  Rejected
## 44   v29  1.92976322  2.02672942 -1.01426944  3.94053920     0.06  Rejected
## 45   v77  1.71202543  1.94166538 -0.75931777  3.68983000     0.11  Rejected
## 46    v4  1.70029373  1.91817909  0.46709705  2.59664766     0.00  Rejected
## 47   v19  1.68160614  1.90281832  0.03674976  2.86211389     0.00  Rejected
## 48   v96  1.71848055  1.83065646 -1.24176326  3.84655016     0.08  Rejected
## 49   v40  1.69280574  1.79979191  0.49220671  2.71361340     0.00  Rejected
## 50   v81  1.66919194  1.75760760 -0.19755703  2.94007092     0.00  Rejected
## 51  v117  1.82067431  1.72449874  0.36092533  3.45682227     0.07  Rejected
## 52   v55  1.72920985  1.66817978  0.23766740  3.21082927     0.00  Rejected
## 53  v104  1.36046328  1.65557190 -0.47981146  2.57491836     0.01  Rejected
## 54  v119  1.69054715  1.58039435 -0.43417231  4.03186050     0.06  Rejected
## 55   v83  1.73040521  1.56062219 -0.54552598  4.13578237     0.06  Rejected
## 56   v85  1.45425051  1.56057339 -0.45493654  3.10264321     0.03  Rejected
## 57   v26  1.51517502  1.55045582 -0.79204559  3.53465563     0.02  Rejected
## 58    v9  1.39017199  1.54782521  0.19840734  2.44322613     0.00  Rejected
## 59   v80  1.32985221  1.54061997 -0.62851193  2.68536829     0.01  Rejected
## 60  v120  1.32028620  1.46398463 -0.59292382  2.62202714     0.00  Rejected
## 61   v41  1.27798455  1.45409254 -1.05403315  3.29121226     0.01  Rejected
## 62  v123  1.25954013  1.42911207 -0.25289736  2.49022115     0.00  Rejected
## 63  v113  1.31855518  1.37971722 -0.79855116  2.71176346     0.01  Rejected
## 64   v82  1.32617503  1.33581798 -0.27021568  4.22868330     0.00  Rejected
## 65  v118  1.28072762  1.30148711 -0.26426312  2.94420380     0.00  Rejected
## 66   v69  0.84846864  1.29847247 -1.02004818  2.41192040     0.00  Rejected
## 67   v61  1.21900254  1.22288688 -0.11166041  3.42625325     0.00  Rejected
## 68  v100  0.74735292  1.15531833 -1.53817571  2.19038342     0.00  Rejected
## 69   v60  1.15567851  1.14915117 -0.65907760  3.04823541     0.00  Rejected
## 70   v13  0.99219421  1.09428139 -1.29863783  2.07050393     0.01  Rejected
## 71  v116  1.08756610  1.07847690 -1.60895060  2.98741785     0.02  Rejected
## 72   v94  1.20295020  1.06994608 -0.75027560  3.13322477     0.00  Rejected
## 73   v65  1.16856579  1.06993183 -0.14903923  2.81205747     0.00  Rejected
## 74  v112  1.06585917  1.05565333 -0.33999024  2.68697784     0.02  Rejected
## 75   v42  0.76029694  0.99730605 -1.71198797  1.98159649     0.00  Rejected
## 76   v11  0.95471230  0.97286760 -0.41951249  2.42573647     0.00  Rejected
## 77   v39  1.05768537  0.96215378 -0.03826160  2.38128169     0.00  Rejected
## 78  v130  0.81897954  0.95788500 -1.71382332  3.57682924     0.01  Rejected
## 79   v23  0.90148604  0.95535217 -0.58662830  2.56865562     0.00  Rejected
## 80   v46  1.10358093  0.89244576 -0.50483787  3.35965650     0.03  Rejected
## 81  v115  0.88485644  0.86276334 -0.78468309  2.34059141     0.00  Rejected
## 82   v45  0.63304135  0.85982903 -1.44877100  2.42441716     0.00  Rejected
## 83   v88  0.91522272  0.85425466 -2.90662204  2.58684486     0.00  Rejected
## 84   v67  0.79020148  0.79469095 -0.52046000  2.23361553     0.00  Rejected
## 85   v58  0.78816217  0.79383682 -0.83166832  1.94221962     0.00  Rejected
## 86   v43  0.83904938  0.79380474 -0.58081673  2.62169371     0.01  Rejected
## 87  v105  1.08400921  0.76280123  0.27292827  2.41497798     0.00  Rejected
## 88  v124  0.70445357  0.75194465 -1.34338414  2.33084686     0.00  Rejected
## 89   v25  0.73601149  0.72652188 -1.66540130  2.56109631     0.00  Rejected
## 90  v102  0.83339757  0.72013693 -0.32767533  1.99758122     0.00  Rejected
## 91   v53  0.45969285  0.67537702 -2.06605945  1.74306039     0.00  Rejected
## 92  v122  0.75906088  0.65844371 -1.02406201  2.81556501     0.00  Rejected
## 93    v8  0.74008520  0.64089072 -0.77977012  2.02673453     0.00  Rejected
## 94    v6  0.55301980  0.64034681 -1.27730983  1.94551035     0.00  Rejected
## 95   v35  0.52778918  0.63028443 -1.06946835  1.48181498     0.00  Rejected
## 96   v16  0.35754630  0.62764285 -1.35928082  1.02670255     0.00  Rejected
## 97   v37  0.61540109  0.62241301 -1.49155700  2.53538411     0.01  Rejected
## 98   v68  0.60349529  0.59877465 -1.05645822  2.92072958     0.00  Rejected
## 99  v131  0.55891333  0.59745721 -0.44448453  1.48862912     0.00  Rejected
## 100  v98  0.53001569  0.50908769 -2.07135725  2.19049962     0.00  Rejected
## 101  v49  0.53009459  0.48960206 -1.07825868  1.61804675     0.00  Rejected
## 102 v107  0.39993956  0.40467713 -0.86263776  1.54627542     0.00  Rejected
## 103  v57  0.52811113  0.39598984 -1.32910450  1.96204100     0.00  Rejected
## 104  v71  0.11008805  0.38556767 -2.51061261  2.13878702     0.00  Rejected
## 105   v7  0.38057689  0.36448320 -1.63267750  2.15366829     0.00  Rejected
## 106  v54  0.38415590  0.32582947 -1.70978044  2.79678921     0.01  Rejected
## 107  v92  0.41394597  0.28381800 -1.16519307  1.93853637     0.00  Rejected
## 108  v89  0.15620537  0.22609464 -1.61982464  2.05308962     0.00  Rejected
## 109 v127  0.48596245  0.21392506 -0.52167615  2.16254545     0.00  Rejected
## 110  v95  0.33693519  0.16916814 -1.01508884  2.72480988     0.00  Rejected
## 111  v90  0.32555713  0.16018918 -1.10839591  1.73064074     0.00  Rejected
## 112  v63  0.38601683  0.14296509 -2.00393948  2.19861387     0.00  Rejected
## 113  v78 -0.06452620  0.10205014 -1.56918688  1.41085341     0.00  Rejected
## 114  v30  0.01432681  0.05072763 -1.61237040  1.46521744     0.00  Rejected
## 115  v56  0.50898473  0.04523847 -1.00685163  3.05051371     0.00  Rejected
## 116  v28 -0.10616747  0.04252038 -2.77129225  1.50432326     0.00  Rejected
## 117  v18  0.28463861  0.02456962 -0.96674425  1.74888263     0.00  Rejected
## 118   v1  0.25091241  0.01929688 -1.90406184  2.14095975     0.00  Rejected
## 119  v74 -0.19893825  0.00000000 -1.35245852  1.00100150     0.00  Rejected
## 120  v27  0.10054990 -0.01698119 -1.19930945  1.97470229     0.00  Rejected
## 121  v75 -0.06765557 -0.04039931 -2.18861603  1.27679193     0.00  Rejected
## 122  v99  0.36769655 -0.04634635 -0.78138922  3.01873205     0.01  Rejected
## 123  v91 -0.16946464 -0.26507284 -2.18227747  1.89184052     0.00  Rejected
## 124 v126  0.06954222 -0.37626432 -1.22386430  2.34745725     0.00  Rejected
## 125 v125 -0.52838528 -0.50194284 -2.62789963  0.96108603     0.00  Rejected
## 126  v52 -0.54925233 -0.53012202 -2.25535023  1.48742073     0.00  Rejected
## 127  v72 -0.40910549 -0.59568084 -2.37334778  1.04303162     0.00  Rejected
## 128  v24 -0.05704926 -0.62609476 -1.62339372  1.80641932     0.00  Rejected
## 129  v22 -0.73222208 -0.78367003 -1.73022650  0.09014474     0.00  Rejected
## 130   v3 -0.62959425 -0.99962515 -1.73669607  1.73709757     0.00  Rejected
## 131  v38 -1.21336900 -1.19982220 -2.48935718  1.52463094     0.00  Rejected